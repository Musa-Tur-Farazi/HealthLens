(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(7637)}])},7637:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(5893),a=s(7294),i=s(3967),l=s.n(i);async function n(e,t){let s="".concat("http://127.0.0.1:8000","/v1/diag"),r=async()=>{let r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topk:3,include_cam:!0,...e}),signal:t});if(!r.ok){let e=await r.text().catch(()=>"");throw Error("API ".concat(r.status,": ").concat(e||r.statusText))}return r.json()};try{return await r()}catch(e){if(/^(502|504)/.test((null==e?void 0:e.message)||""))return await r();throw e}}var d=s(1465),c=s(2003),o=s(512),m=s(8388);function x(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,m.m6)((0,o.W)(t))}let u=(0,c.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=a.forwardRef((e,t)=>{let{className:s,variant:a,size:i,asChild:l=!1,...n}=e,c=l?d.g7:"button";return(0,r.jsx)(c,{className:x(u({variant:a,size:i,className:s})),ref:t,...n})});h.displayName="Button";let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("rounded-xl border bg-card text-card-foreground shadow",s),...a})});p.displayName="Card",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("flex flex-col space-y-1.5 p-6",s),...a})}).displayName="CardHeader",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("font-semibold leading-none tracking-tight",s),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("text-sm text-muted-foreground",s),...a})}).displayName="CardDescription",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("p-6 pt-0",s),...a})}).displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:x("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter";let g=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:x("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...a})});g.displayName="Textarea";var f=s(7874),b=s(6518),y=s(9122);function v(e){let{size:t=32}=e;return(0,r.jsxs)("svg",{width:t,height:t,viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("linearGradient",{id:"g",x1:"0",x2:"1",y1:"0",y2:"1",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#2563eb"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#22d3ee"})]})}),(0,r.jsx)("rect",{x:"4",y:"4",width:"56",height:"56",rx:"14",fill:"url(#g)"}),(0,r.jsxs)("g",{fill:"#fff",children:[(0,r.jsx)("circle",{cx:"24",cy:"28",r:"6",opacity:"0.95"}),(0,r.jsx)("circle",{cx:"40",cy:"36",r:"8",opacity:"0.9"}),(0,r.jsx)("path",{d:"M18 46c6-8 22-8 28 0",opacity:"0.85"})]})]})}var j=s(1093);function N(){var e;let[t,s]=(0,a.useState)(null),[i,d]=(0,a.useState)(""),[c,o]=(0,a.useState)(""),[m,x]=(0,a.useState)(null),[u]=(0,a.useState)(!0),[N,C]=(0,a.useState)("idle"),[R,E]=(0,a.useState)(null),[D,P]=(0,a.useState)(null),[F,I]=(0,a.useState)(!1),M=(0,a.useRef)(null),[A,O]=(0,a.useState)(!1),[T,L]=(0,a.useState)("light"),[z,B]=(0,a.useState)(!1);(0,a.useEffect)(()=>{B(!0);let e=localStorage.getItem("hl:theme");e?L(e):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&L("dark")},[]),(0,a.useEffect)(()=>{if(!z)return;let e=document.documentElement;"dark"===T?e.classList.add("dark"):e.classList.remove("dark"),localStorage.setItem("hl:theme",T)},[T,z]),(0,a.useEffect)(()=>{try{let e=localStorage.getItem("hl:last");e&&P(JSON.parse(e))}catch(e){}},[]),(0,a.useEffect)(()=>{D&&localStorage.setItem("hl:last",JSON.stringify(D))},[D]);let J=(0,a.useCallback)(()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},[]),G=(0,a.useCallback)(async e=>{if(!e)return;if(e.size>8388608){E("File too large (max 8MB).");return}E(null),P(null),C("uploading"),d("".concat(e.name," — ").concat((e.size/1024).toFixed(0)," KB"));let t=new FileReader;t.onload=()=>{s(t.result),C("idle")},t.onerror=()=>{E("Failed to read file"),C("idle")},t.readAsDataURL(e)},[]),H=(0,a.useCallback)(async()=>{if(!t){E("Please upload an image.");return}if(!m){O(!0),E("Please select an image type.");return}E(null),C("classifying");try{let e=await n({modality:m,symptoms:c,topk:3,include_cam:u,image_b64:t});C("generating"),P(e)}catch(e){E((null==e?void 0:e.message)||"Request failed")}finally{C("idle")}},[t,m,c,u]),W=null==D?void 0:D.topk,X=!!D;return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-gray-100 to-gray-200 dark:from-gray-950 dark:to-gray-900",children:[(0,r.jsxs)("header",{className:"border-b px-4 py-3 flex items-center justify-between backdrop-blur bg-white/60 dark:bg-gray-900/50",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(v,{size:28}),(0,r.jsx)("h1",{className:"font-semibold tracking-tight",children:"HealthLens"})]}),(0,r.jsx)("div",{children:(0,r.jsxs)(h,{variant:"outline",className:"gap-2",onClick:()=>L(e=>"dark"===e?"light":"dark"),children:["dark"===T?(0,r.jsx)(f.Z,{className:"h-4 w-4"}):(0,r.jsx)(b.Z,{className:"h-4 w-4"}),"dark"===T?"Light":"Dark"]})})]}),(0,r.jsx)("main",{className:"flex-1 max-w-7xl w-full mx-auto p-6 space-y-6",children:(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-8 items-start",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:l()("rounded-2xl border border-dashed p-6 text-center h-[420px] flex flex-col items-center justify-center backdrop-blur-md shadow-sm transition-all","bg-white/60 dark:bg-gray-900/40 hover:shadow-md",F?"ring-2 ring-blue-500":"ring-0"),onClick:X?void 0:J,onDragOver:e=>{X||(e.preventDefault(),I(!0))},onDragLeave:()=>{X||I(!1)},onDrop:e=>{var t;if(X)return;e.preventDefault(),I(!1);let s=null===(t=e.dataTransfer.files)||void 0===t?void 0:t[0];s&&G(s)},children:[t?(0,r.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center",children:[(0,r.jsx)("img",{src:t,alt:"preview",className:"max-h-[360px] object-contain"}),X&&(0,r.jsx)("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 text-[11px] px-2 py-1 rounded-full border bg-white/70 dark:bg-gray-900/60",children:"Image locked — press Reset to change"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z,{className:"h-7 w-7 mb-2 text-blue-600"}),(0,r.jsx)("p",{className:"font-medium",children:"Drag & drop or click to upload"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"JPEG/PNG, up to 8MB"})]}),(0,r.jsx)("input",{ref:M,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&G(s)}})]}),(0,r.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-300 h-5",children:i}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Select image type"}),!m&&A&&(0,r.jsx)("span",{className:"text-xs text-red-600",children:"Please select one"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsx)("button",{onClick:()=>{x("disease"),O(!0),E(null)},disabled:X,className:l()("px-4 py-3 rounded-xl border-2 transition-all text-sm font-medium","bg-white/60 dark:bg-gray-900/40 backdrop-blur-sm","disease"===m?"border-blue-500 ring-2 ring-blue-500/50 text-blue-700 dark:text-blue-300":!m&&A?"border-red-500":"border-gray-300 dark:border-gray-700 hover:border-blue-400",X?"opacity-50 cursor-not-allowed":"cursor-pointer"),children:"Skin Lesion/Histopathological Image"}),(0,r.jsx)("button",{onClick:()=>{x("xray"),O(!0),E(null)},disabled:X,className:l()("px-4 py-3 rounded-xl border-2 transition-all text-sm font-medium","bg-white/60 dark:bg-gray-900/40 backdrop-blur-sm","xray"===m?"border-blue-500 ring-2 ring-blue-500/50 text-blue-700 dark:text-blue-300":!m&&A?"border-red-500":"border-gray-300 dark:border-gray-700 hover:border-blue-400",X?"opacity-50 cursor-not-allowed":"cursor-pointer"),children:"X-Ray Image"})]})]}),(0,r.jsx)(g,{value:c,onChange:e=>o(e.target.value),rows:8,placeholder:"Describe symptoms (optional)",className:"rounded-2xl border bg-white/60 dark:bg-gray-900/50 backdrop-blur-sm shadow-sm focus:ring-2 focus:ring-blue-500"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(h,{onClick:H,disabled:"idle"!==N,children:["idle"===N&&(D?"Retry Prompt":"Send"),"uploading"===N&&"Uploading…","classifying"===N&&"Classifying…","generating"===N&&"Generating…"]}),(0,r.jsx)(h,{variant:"outline",onClick:()=>{try{localStorage.removeItem("hl:last")}catch(e){}s(null),P(null),o(""),d(""),I(!1),E(null),x(null),M.current&&(M.current.value="")},children:"Reset"})]}),R&&(0,r.jsx)("div",{className:"text-red-600 text-sm",children:R})]}),(0,r.jsx)("div",{className:"space-y-4",children:D?(0,r.jsxs)("div",{className:"space-y-3",children:[W&&W.length>0&&(0,r.jsx)(j.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.35},children:(0,r.jsxs)(p,{className:"p-4",children:[(0,r.jsx)("h3",{className:"font-semibold mb-3",children:"Top predictions"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 items-center",children:[(0,r.jsx)(j.E.div,{initial:{scale:.9},animate:{scale:1},transition:{duration:.4},children:(0,r.jsx)(S,{data:W.slice(0,3)})}),(0,r.jsx)("div",{className:"space-y-2",children:W.slice(0,3).map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"inline-block h-3 w-3 rounded-full",style:{background:w(t)}}),(0,r.jsx)("span",{children:e.label})]}),(0,r.jsxs)("span",{className:"font-medium",children:[(100*e.prob).toFixed(1),"%"]})]},t))})]})]})}),W&&W.length>0&&(0,r.jsx)(j.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.35,delay:.03},children:(0,r.jsxs)(p,{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Primary diagnosis"}),(0,r.jsx)("div",{className:"text-lg font-semibold mt-1",children:W[0].label})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Probability"}),(0,r.jsxs)("div",{className:"text-lg font-semibold",children:[(100*W[0].prob).toFixed(1),"%"]})]})]}),(null==D?void 0:null===(e=D.report)||void 0===e?void 0:e.next_steps)&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("div",{className:"font-semibold",children:"Recommended next steps"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:_(D.report.next_steps).map((e,t)=>(0,r.jsx)("li",{children:e},t))})]})]})}),D.cam_b64&&(0,r.jsx)("div",{children:(0,r.jsx)("img",{src:D.cam_b64,alt:"Grad-CAM",className:"rounded-xl border max-h-64 object-contain shadow"})}),D.report&&(0,r.jsx)(j.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.35,delay:.05},children:(0,r.jsx)(p,{className:"p-4",children:(0,r.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Impression"}),(0,r.jsx)("div",{className:"whitespace-pre-wrap",children:k(D.report.impression)})]}),D.report.findings&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Findings"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:_(D.report.findings).map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),D.report.disease_summary&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"About the Disease"}),(0,r.jsx)("div",{className:"whitespace-pre-wrap bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border-l-4 border-blue-400",children:k(D.report.disease_summary)})]}),D.report.red_flags&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Red Flags"}),(0,r.jsx)("ul",{className:"list-disc pl-5 mt-1 space-y-1 text-red-700 dark:text-red-400",children:_(D.report.red_flags).map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Next Steps"}),(0,r.jsx)("div",{className:"whitespace-pre-wrap",children:k(D.report.next_steps)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-semibold",children:"Disclaimer"}),(0,r.jsx)("div",{className:"whitespace-pre-wrap text-gray-600 dark:text-gray-400 text-xs",children:k(D.report.disclaimer)})]})]})})})]}):(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"No results yet."})})]})}),(0,r.jsx)("footer",{className:"px-4 py-3 text-xs text-center text-gray-500 border-t backdrop-blur bg-white/60 dark:bg-gray-900/50",children:"Research demo. Not medical advice."})]})}function w(e){let t=["#2563eb","#16a34a","#f59e0b"];return t[e%t.length]}function k(e){return e?Array.isArray(e)?e.join("\n"):"object"==typeof e?JSON.stringify(e,null,2):String(e):""}function S(e){let{data:t}=e,s=2*Math.PI*70,a=Math.max(1e-8,t.reduce((e,t)=>e+Math.max(0,t.prob||0),0)),i=0;return(0,r.jsx)("svg",{width:160,height:160,viewBox:"0 0 ".concat(160," ").concat(160),className:"mx-auto",children:(0,r.jsxs)("g",{transform:"translate(".concat(80,",").concat(80,")"),children:[(0,r.jsx)("circle",{r:70,fill:"none",stroke:"#e5e7eb",strokeWidth:18}),t.map((e,t)=>{let l=Math.max(0,e.prob||0)/a*s,n="".concat(l," ").concat(s-l),d=i/s*360-90;return i+=l,(0,r.jsx)("circle",{r:70,fill:"none",stroke:w(t),strokeWidth:18,strokeLinecap:"butt",strokeDasharray:n,transform:"rotate(".concat(d,")")},t)}),(()=>{let e=(100*Math.max(0,...t.map(e=>e.prob||0))).toFixed(1)+"%";return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("text",{textAnchor:"middle",dominantBaseline:"middle",fontSize:"20",y:0,fill:"currentColor",className:"text-gray-900 dark:text-white font-semibold",children:e})})})()]})})}function _(e){return e?Array.isArray(e)?e:"string"==typeof e?[e]:[JSON.stringify(e)]:[]}}},function(e){e.O(0,[890,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);